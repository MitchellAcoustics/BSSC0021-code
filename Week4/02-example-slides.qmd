---
title: "Hypothesis Testing"
subtitle: "Part 2: Body Cameras Example and NHST Process"
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(ggplot2)
library(cowplot)
library(knitr)
library(NHANES)

# drop duplicated IDs within the NHANES dataset
NHANES <- 
  NHANES %>% 
  dplyr::distinct(ID,.keep_all = TRUE)

NHANES_adult <- 
  NHANES %>%
  drop_na(PhysActive,BMI) %>%
  subset(Age >= 18)
```

## Real World Example: Police Body Cameras

Key Question: Do body-worn cameras reduce use of force by police officers?

Washington DC Study (2015/2016):

- Large-scale randomized controlled trial
- Officers randomly assigned to two groups:
  * Treatment: Wear body camera
  * Control: No body camera
- Tracked key outcomes:
  * Use of force incidents
  * Civilian complaints
  * Officer behavior

This is a perfect example to understand hypothesis testing.

::: {.notes}
There is great interest in the use of body-worn cameras by police officers, which are thought to reduce the use of force and improve officer behavior. However, in order to establish this we need experimental evidence, and it has become increasingly common for governments to use randomized controlled trials to test such ideas.

A randomized controlled trial of the effectiveness of body-worn cameras was performed by the Washington, DC government and DC Metropolitan Police Department in 2015/2016. Officers were randomly assigned to wear a body-worn camera or not, and their behavior was then tracked over time to determine whether the cameras resulted in less use of force and fewer civilian complaints about officer behavior.
::::

## Our Intuitive Approach vs. NHST

What we might naturally want to do:

::: {.columns}
::: {.column width="50%"}

1. Collect the data
2. Compare use of force between groups

::::
::: {.column width="50%"}

3. Calculate probability that cameras reduce force
4. Make decision based on that probability

::::
::::

```{r body-camera-viz}
#| fig-width: 8
#| fig-height: 4
#| echo: false

# Create example visualization of hypothesis testing concept
set.seed(123)
x <- seq(-4, 4, length.out = 100)
null_dist <- dnorm(x)
alt_dist <- dnorm(x, mean = 1)

df <- data.frame(
  x = rep(x, 2),
  y = c(null_dist, alt_dist),
  Distribution = rep(c("Null", "Alternative"), each = 100)
)

ggplot(df, aes(x, y, color = Distribution)) +
  geom_line() +
  labs(title = "What We Want: Direct Evidence for Each Hypothesis",
       x = "Effect of Body Cameras on Use of Force",
       y = "Probability") +
  theme_minimal()
```

::: {.notes}
Before we get to the results, let's ask how you would think the statistical analysis might work. Let's say we want to specifically test the hypothesis of whether the use of force is decreased by the wearing of cameras. The randomized controlled trial provides us with the data to test the hypothesis -- namely, the rates of use of force by officers assigned to either the camera or control groups. The next obvious step is to look at the data and determine whether they provide convincing evidence for or against this hypothesis.
::::

## How NHST Actually Works

What NHST requires instead:

::: {.columns}
::: {.column width="50%"}

1. Start with null hypothesis: "Cameras have no effect"
2. Assume this null hypothesis is true
::::
::: {.column width="50%"}

3. Ask: How surprising is our data if null is true?
4. Only reject null if data very unlikely under null

::::
::::

```{r nhst-process}
#| fig-width: 8
#| fig-height: 4
#| echo: false

# Create visualization of NHST process
set.seed(123)
x <- seq(-4, 4, length.out = 100)
y <- dnorm(x)
crit_value <- qnorm(0.975)
df <- data.frame(x = x, y = y)

ggplot(df, aes(x, y)) +
  geom_line() +
  geom_area(data = subset(df, x >= crit_value | x <= -crit_value),
            fill = "red", alpha = 0.3) +
  labs(title = "NHST Approach: Is Data Unlikely Under Null?",
       x = "Observed Difference in Use of Force",
       y = "Probability if Null is True",
       caption = "Red areas show 'surprising' results") +
  theme_minimal()
```

::: {.notes}
It turns out that this is *not* how null hypothesis testing works. Instead, we first take our hypothesis of interest (i.e. that body-worn cameras reduce use of force), and flip it on its head, creating a *null hypothesis* -- in this case, the null hypothesis would be that cameras do not reduce use of force. Importantly, we then assume that the null hypothesis is true. We then look at the data, and determine how likely the data would be if the null hypothesis were true.
::::

## The Six Steps of NHST

::: {.columns}
::: {.column width="50%"}

1. **Formulate Research Hypothesis**
   - Must be done before seeing data
   - Based on theory and prior research
   - Clear and testable prediction

2. **Specify Hypotheses**
   - Null (H₀): What we assume is true
   - Alternative (H₁): What we hope to show

3. **Collect Data**
   - Following proper research design
   - Appropriate sample size
   - Careful measurement

:::: 
::: {.column width="50%"}

4. **Compute Test Statistic**
   - Summarizes evidence against null
   - Accounts for sample size
   - Controls for variability

5. **Calculate Probability**
   - Assuming null is true
   - How surprising is our result?
   - This gives us the p-value

6. **Make Decision**
   - Based on pre-specified criteria
   - Usually p < 0.05
   - Consider practical significance

::::
::::

::: {.notes}
We can break the process of null hypothesis testing down into these six key steps. Each step is crucial and must be done in order. The process is designed to be rigorous and systematic, even though it may seem counterintuitive at first.
::::

## Example: Physical Activity and BMI

Research Question: 
Does regular physical activity affect body mass index (BMI)?

Using NHANES data:

- PhysActive: Do you engage in regular moderate/vigorous activity?
- BMI: Body Mass Index = weight(kg)/height$(m)^2$

```{r bmi-setup}
#| echo: false

# Sample summary statistics
sample_summary <- 
  NHANES_adult %>%
  group_by(PhysActive) %>%
  summarise(
    n = n(),
    mean_bmi = mean(BMI),
    sd_bmi = sd(BMI)
  )
```

Summary Statistics:

- Active (n=`r sample_summary$n[2]`): Mean BMI = `r round(sample_summary$mean_bmi[2], 1)`
- Inactive (n=`r sample_summary$n[1]`): Mean BMI = `r round(sample_summary$mean_bmi[1], 1)`

We'll work through the NHST process step by step...

::: {.notes}
For a hands-on example, let's use the NHANES data to ask whether physical activity is related to body mass index. In the NHANES dataset, participants were asked whether they engage regularly in moderate or vigorous-intensity sports, fitness or recreational activities (stored in the variable PhysActive). The researchers also measured height and weight and used them to compute the Body Mass Index (BMI).

This example will help us understand how NHST works in practice with real data.
::::
